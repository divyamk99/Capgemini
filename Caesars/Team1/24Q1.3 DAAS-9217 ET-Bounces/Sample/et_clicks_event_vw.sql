CREATE OR REPLACE VIEW DAAS_CORE_MARKETING_VW.ET_CLICKS_EVENT_VW
(
	I_CLIENTID,
	I_SENDID,
	C_SUBSCRIBER_KEY,
	I_DMID,
	C_EMAILADDRESS,
	I_SUBSCRIBERID,
	I_LISTID,
	D_EVENTDATE,
	C_EVENTTYPE,
	I_SENDURLID,
	I_URLID,
	C_URL,
	C_ALIAS,
	C_BATCHID,
	C_TRIGGEREDSENDEXTERNALKEY,
	D_TIMESTAMP,
	C_QUALITY_CD,
	SOURCE_SYSTEM_NAME,
	TIME_ZONE,
	CREATED_DATE,
	CREATED_BY,
	UPDATED_DATE,
	UPDATED_BY,
	BATCH_ID,
	REPLAY_COUNTER,
	SOURCE_FILE_NAME,
	DELETE_IND,
	LAST_DML_CD,
	MD5_CHECKSUM
)
AS
WITH RAW_CTE AS
(
SELECT
	I_CLIENTID,
	I_SENDID,
	C_SUBSCRIBER_KEY,
	I_DMID,
	C_EMAILADDRESS,
	I_SUBSCRIBERID,
	I_LISTID,
	D_EVENTDATE,
	C_EVENTTYPE,
	I_SENDURLID,
	I_URLID,
	C_URL,
	C_ALIAS,
	C_BATCHID,
	C_TRIGGEREDSENDEXTERNALKEY,
	D_TIMESTAMP,
	C_QUALITY_CD
FROM
	DAAS_TERADATA_RAW.ET_CLICKS_EVENT
UNION ALL
SELECT
	I_CLIENTID,
	I_SENDID,
	C_SUBSCRIBER_KEY,
	I_DMID,
	C_EMAILADDRESS,
	I_SUBSCRIBERID,
	I_LISTID,
	D_EVENTDATE,
	C_EVENTTYPE,
	I_SENDURLID,
	I_URLID,
	C_URL,
	C_ALIAS,
	C_BATCHID,
	C_TRIGGEREDSENDEXTERNALKEY,
	D_TIMESTAMP,
	C_QUALITY_CD
FROM
	DAAS_EXACT_TARGET_RAW.ET_CLICKS_EVENT_RAW
)
SELECT
	I_CLIENTID,
	I_SENDID,
	C_SUBSCRIBER_KEY,
	I_DMID,
	C_EMAILADDRESS,
	I_SUBSCRIBERID,
	I_LISTID,
	D_EVENTDATE,
	C_EVENTTYPE,
	I_SENDURLID,
	I_URLID,
	C_URL,
	C_ALIAS,
	C_BATCHID,
	C_TRIGGEREDSENDEXTERNALKEY,
	D_TIMESTAMP,
	C_QUALITY_CD
FROM
	RAW_CTE
QUALIFY ROW_NUMBER() OVER(PARTITION BY I_SENDID, I_DMID, C_BATCHID
ORDER BY D_EVENTDATE DESC, D_TIMESTAMP DESC) = 1
;